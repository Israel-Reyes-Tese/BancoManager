{% extends "base.html" %}
{% load static %}

{% block style %}
{# Cargando estilos personalizados y librerías adicionales #}
<link rel="stylesheet" href="{% static 'css/styles_home.css' %}">
{# Tailwind CSS #}
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.1.2/dist/tailwind.min.css" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container my-5">
    <h1 class="text-center">Resumen General de Deudas</h1>
    <h1 class="text-center">Bienvenido, [Nombre del Usuario]</h1>
    <p class="text-center">Resumen Rápido: <span id="resumen-rapido">3 cuentas, 1 tarjeta de crédito, 2 préstamos activos.</span></p>
    {# Total de Deudas Pendientes #}
    <div class="row text-center mb-4">
        <div class="col">
            <div class="card p-3">
                <h2>Total de Deudas Pendientes</h2>
                <p class="display-4" id="total-deudas">$0</p>
            </div>
        </div>
    </div>

    {# Deudas por Estado #}
    <div class="row mb-4">
        <div class="col">
            <h2>Deudas por Estado</h2>
            <canvas id="deudasPorEstado" width="400" height="200"></canvas>
        </div>
    </div>

    {# Estadísticas de Deudas #}
    <div class="row">
        <div class="col">
            <h2>Deudas por Tipo</h2>
            <canvas id="deudasPorTipo" width="400" height="200"></canvas>
        </div>
        <div class="col">
            <h2>Próximas Fechas de Vencimiento</h2>
            <ul id="deudasProximas" class="list-group">
                {# Deudas se llenarán con jQuery #}
            </ul>
        </div>
    </div>

    {# Filtros y Búsqueda #}
    <div class="row mb-4">
        <div class="col">
            <h2>Filtros y Búsqueda</h2>
            <select class="custom-select my-2" id="estadoDeuda">
                <option selected>Selecciona un estado...</option>
                <option value="saldada">Saldada</option>
                <option value="activa">Activa</option>
            </select>
            <select class="custom-select my-2" id="tipoDeuda">
                <option selected>Selecciona un tipo...</option>
                <option value="tarjeta">Tarjeta de Crédito</option>
                <option value="prestamo">Préstamo</option>
                <option value="usuario">Usuario</option>
            </select>
            <input type="text" class="form-control" id="buscarDeuda" placeholder="Buscar por descripción, monto o fecha de vencimiento">
            <button id="filtrarDeudas" class="btn btn-primary mt-2">Filtrar</button>
        </div>
    </div>

    {# Registro de Nuevas Deudas #}
    <div class="row">
        <div class="col">
            <h2>Registro de Nuevas Deudas</h2>
            <form id="formDeuda">
                <div class="input-group mb-3">
                    <input type="text" class="form-control" placeholder="Monto" id="montoDeuda">
                    <input type="text" class="form-control" placeholder="Descripción" id="descripcionDeuda">
                    <input type="date" class="form-control" id="fechaVencimientoDeuda">
                    <select class="custom-select" id="tipoDeudaRegistro">
                        <option selected>Selecciona un tipo...</option>
                        <option value="tarjeta">Tarjeta de Crédito</option>
                        <option value="prestamo">Préstamo</option>
                        <option value="usuario">Usuario</option>
                    </select>
                    <div class="input-group-append">
                        <button class="btn btn-success" type="submit">Registrar</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    {# Notificaciones y Alertas de Vencimiento #}
    <div id="notificacionesDeudas" class="alert alert-warning" role="alert">
        No hay alertas de vencimientos próximos.
    </div>

    {# Calendario de Vencimientos #}
    <div class="row mb-4">
        <div class="col">
            <h2>Vista de Calendario de Vencimientos</h2>
            {# Placeholder para el calendario #}
            <div id="calendarioDeudas" class="border p-3">
                <p>Calendario interactivo aquí (por implementar)</p>
            </div>
        </div>
    </div>

    {# Panel de Control Financiero #}
    <div class="row mb-4">
        <div class="col">
            <h2>Indicadores de Proporción de Deuda</h2>
            <p>Porcentaje de cada tipo de deuda con respecto al total.</p>
        </div>
    </div>

    {# Botones de Acción Rápida #}
    <div class="text-center mt-4">
        <button class="btn btn-primary" id="btnRegistrarDeuda">Registrar Deuda</button>
        <button class="btn btn-warning" id="btnMarcarSaldada">Marcar como Saldada</button>
        <button class="btn btn-secondary" id="btnExportarDeudas">Exportar Reporte de Deudas</button>
        <button class="btn btn-info" id="btnVerReportesDeudas">Ver Reportes Detallados</button>
    </div>
</div>

{% endblock %}

{% block javascript %}
<script src="{% static 'js/js_home.js' %}"></script>

{# jQuery #}
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<!-- Incluyendo jQuery UI -->
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<!-- Incluyendo el script de bootstrap (opcional si ya está en base.html) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- Incluyendo SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<!-- Incluyendo Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
<!-- Incluyendo DataTables -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>

{# Chart.js para las gráficas #}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
$(document).ready(function() {
    {# Cargar total de deudas, comparativas y estadísticas al cargar la página #}
    $('#total-deudas').text('$4000'); {# Ejemplo #}

    {# Añadir gráficos con Chart.js #}
    var ctx = document.getElementById('deudasPorEstado').getContext('2d');
    var chartEstado = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Saldadas', 'Activas'],
            datasets: [{
                data: [2000, 2000],
                backgroundColor: ['#36A2EB', '#FF6384']
            }]
        }
    });

    var ctx2 = document.getElementById('deudasPorTipo').getContext('2d');
    var chartTipo = new Chart(ctx2, {
        type: 'bar',
        data: {
            labels: ['Tarjeta de Crédito', 'Préstamo', 'Usuario'],
            datasets: [{
                label: 'Deudas por Tipo',
                data: [1500, 2000, 500],
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: true
                    }
                }]
            }
        }
    });

    {# Manejo del formulario para agregar deudas #}
    $('#formDeuda').on('submit', function(event) {
        event.preventDefault();

        var monto = $('#montoDeuda').val();
        var descripcion = $('#descripcionDeuda').val();
        var fechaVencimiento = $('#fechaVencimientoDeuda').val();
        var tipo = $('#tipoDeudaRegistro').val();
        {# Lógica para agregar la deuda... #}

        $('#deudasProximas').append('<li class="list-group-item">' + descripcion + ': $' + monto + ' - Vence el: ' + fechaVencimiento + '</li>');
    });
});
</script>
{% endblock %}